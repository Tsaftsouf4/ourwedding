<!doctype html>
<html lang="el">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Πρόσκληση Γάμου</title>

<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{width:100%;height:100%;overflow:hidden;background:#f6ead8}

  :root{
    --pageAspect: 1.45;             /* height / width */
    --shadow: 0 18px 40px rgba(0,0,0,.22);
    --radius: 22px;
    --bg: #f6ead8;

    /* “Απλή σελίδα” feel */
    --turnDur: .45s;
    --turnEase: cubic-bezier(.2,.85,.2,1);
  }

  .wrap{
    width:100vw;height:100svh;
    display:flex;align-items:center;justify-content:center;
    position:relative;
    background:var(--bg);
  }

  /* ===== STAGE ===== */
  .stage{
    position:relative;
    /* no perspective -> less “book” */
    perspective: none;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  /* ===== LAYOUTS ===== */
  .spread{
    display:flex;
    gap:28px;
    align-items:center;
    justify-content:center;
  }

  .page{
    border-radius: var(--radius);
    overflow:hidden;
    box-shadow: var(--shadow);
    background:transparent;
  }
  .page img{
    width:100%;height:100%;
    object-fit:contain;
    display:block;
  }

  /* Buttons */
  .nav{
    position:absolute;
    bottom:26px;
    display:flex;
    gap:14px;
    z-index:50;
  }
  button{
    background: rgba(255,255,255,.65);
    border:none;
    padding:10px 18px;
    border-radius:999px;
    font-size:14px;
    cursor:pointer;
    backdrop-filter: blur(6px);
  }
  button:disabled{
    opacity:.45;
    cursor:not-allowed;
  }

  /* ===== FLIP LAYER (SIMPLE PAGE TURN) ===== */
  .flipLayer{
    position:absolute;
    top:0;left:0;
    transform-style: flat; /* no 3d */
    z-index:40;
    pointer-events:none;
    display:none;
  }
  .flipLayer.show{ display:block; }

  .sheet{
    position:absolute;
    top:0;left:0;
    width:100%;height:100%;
    transform-origin: 0% 50%;
  }

  /* We keep front/back but use tiny rotation + fade */
  .face{
    position:absolute;
    top:0;left:0;
    width:100%;height:100%;
    backface-visibility:hidden;
    border-radius: var(--radius);
    overflow:hidden;
    box-shadow: var(--shadow);
    background:transparent;
  }
  .face img{
    width:100%;height:100%;
    object-fit:contain;
    display:block;
  }

  /* back is NOT fully “book mirrored”, just subtle */
  .back{
    transform: none;
    opacity: 0;
  }

  /* very subtle highlight while turning */
  .gloss{
    position:absolute;inset:0;
    background: linear-gradient(90deg,
      rgba(255,255,255,0),
      rgba(255,255,255,.22),
      rgba(255,255,255,0)
    );
    opacity:0;
    pointer-events:none;
    border-radius: var(--radius);
  }

  /* Simple “page” animation: small rotate + slide + fade */
  @keyframes turnPageSimple {
    0%   { transform: translateX(0) rotateY(0deg);   opacity:1; filter:brightness(1); }
    60%  { transform: translateX(18px) rotateY(-16deg); opacity:.85; filter:brightness(.985); }
    100% { transform: translateX(30px) rotateY(-24deg); opacity:0; filter:brightness(.97); }
  }

  @keyframes revealNext {
    0%   { opacity:0; transform: translateX(-14px); }
    55%  { opacity:.55; }
    100% { opacity:1; transform: translateX(0); }
  }

  @keyframes glossMoveSimple {
    0%   { opacity:0; transform: translateX(-30%); }
    35%  { opacity:.20; }
    100% { opacity:0; transform: translateX(30%); }
  }

  .turningFront{ animation: turnPageSimple var(--turnDur) var(--turnEase) forwards; }
  .revealingBack{ animation: revealNext var(--turnDur) var(--turnEase) forwards; }
  .turningFront .gloss{ animation: glossMoveSimple var(--turnDur) var(--turnEase) forwards; }

  /* ===== SIZES ===== */
  @media (min-width: 901px){
    .page{
      width: min(38vw, 420px);
      height: calc(min(38vw, 420px) * var(--pageAspect));
    }
    .stage{
      width: calc((min(38vw, 420px) * 2) + 28px);
      height: calc(min(38vw, 420px) * var(--pageAspect));
    }
  }

  @media (max-width: 900px){
    .stage{
      width: min(92vw, calc((100svh - 200px) / var(--pageAspect)));
      height: calc(
        min(92vw, calc((100svh - 200px) / var(--pageAspect))) * var(--pageAspect)
      );
    }
    .page{
      width:100%;
      height:100%;
    }
  }

  .hidden{ display:none !important; }
</style>
</head>

<body>
<div class="wrap">

  <div class="stage" id="stage">

    <!-- Desktop container -->
    <div class="spread" id="spreadDesktop">
      <div class="page" id="desktopLeft"><img id="desktopLeftImg" src="assets/left.png" alt="Ο γάμος μας"></div>
      <div class="page" id="desktopRight"><img id="desktopRightImg" src="assets/right.png" alt="Η ημέρα μας"></div>
    </div>

    <!-- Cover (used in desktop at start + mobile pages) -->
    <div class="page" id="coverSingle"><img src="assets/cover.png" alt="Cover"></div>

    <!-- Flip layer (simple page turn) -->
    <div class="flipLayer" id="flipLayer">
      <div class="sheet" id="sheet">
        <div class="face front" id="frontFace">
          <img id="frontImg" src="" alt="">
          <div class="gloss"></div>
        </div>
        <div class="face back" id="backFace">
          <img id="backImg" src="" alt="">
          <div class="gloss"></div>
        </div>
      </div>
    </div>

    <!-- Mobile page (single) -->
    <div class="page hidden" id="mobileSingle"><img id="mobileImg" src="" alt=""></div>

  </div>

  <div class="nav">
    <button id="prevBtn" onclick="prev()">◀ Πίσω</button>
    <button id="nextBtn" onclick="next()">Μπροστά ▶</button>
  </div>

</div>

<audio id="flipSound" src="assets/flip.mp3" preload="auto"></audio>

<script>
  const sound = document.getElementById('flipSound');

  const stage = document.getElementById('stage');
  const spreadDesktop = document.getElementById('spreadDesktop');
  const coverSingle = document.getElementById('coverSingle');

  const mobileSingle = document.getElementById('mobileSingle');
  const mobileImg = document.getElementById('mobileImg');

  const flipLayer = document.getElementById('flipLayer');
  const sheet = document.getElementById('sheet');

  const frontFace = document.getElementById('frontFace');
  const backFace  = document.getElementById('backFace');

  const frontImg = document.getElementById('frontImg');
  const backImg  = document.getElementById('backImg');

  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  const ASSETS = [
    "assets/cover.png",
    "assets/left.png",
    "assets/right.png"
  ];

  function isMobile(){ return window.innerWidth <= 900; }

  // Desktop states:
  // 0 = cover (single)
  // 1 = spread (left+right)
  let desktopState = 0;

  // Mobile index: 0 cover, 1 left, 2 right
  let mobileIndex = 0;

  function playFlip(){
    sound.currentTime = 0;
    sound.playbackRate = 1.15; // πιο “μαλακό” από πριν
    sound.play().catch(()=>{});
  }

  function updateButtons(){
    if (isMobile()){
      prevBtn.disabled = (mobileIndex <= 0);
      nextBtn.disabled = (mobileIndex >= 2);
    } else {
      prevBtn.disabled = (desktopState <= 0);
      nextBtn.disabled = (desktopState >= 1);
    }
  }

  function showDesktop(){
    mobileSingle.classList.add('hidden');
    spreadDesktop.classList.toggle('hidden', desktopState === 0);
    coverSingle.classList.toggle('hidden', desktopState !== 0);
    updateButtons();
  }

  function showMobile(){
    spreadDesktop.classList.add('hidden');
    coverSingle.classList.add('hidden');
    mobileSingle.classList.remove('hidden');
    mobileImg.src = ASSETS[mobileIndex];
    updateButtons();
  }

  function layout(){
    if (isMobile()) showMobile();
    else showDesktop();
  }

  // SIMPLE page turn animation (not “book”)
  // fromSrc = current visible page image
  // toSrc   = next page image
  function doFlip(fromSrc, toSrc, onDone){
    const rect = stage.getBoundingClientRect();

    let w, h, left, top;

    if (isMobile()){
      w = rect.width; h = rect.height; left = 0; top = 0;
    } else {
      const c = coverSingle.getBoundingClientRect();
      w = c.width; h = c.height;
      left = (rect.width - w) / 2;
      top  = (rect.height - h) / 2;
    }

    flipLayer.style.width = w + "px";
    flipLayer.style.height = h + "px";
    flipLayer.style.transform = `translate(${left}px, ${top}px)`;
    flipLayer.classList.add('show');

    frontImg.src = fromSrc;
    backImg.src  = toSrc;

    // reset classes
    frontFace.classList.remove('turningFront');
    backFace.classList.remove('revealingBack');
    void sheet.offsetWidth;

    playFlip();

    // animate: front “leaves”, back “appears”
    frontFace.classList.add('turningFront');
    backFace.classList.add('revealingBack');

    const done = () => {
      frontFace.removeEventListener('animationend', done);
      flipLayer.classList.remove('show');
      frontFace.classList.remove('turningFront');
      backFace.classList.remove('revealingBack');
      if (onDone) onDone();
    };

    // listen on front end (same duration)
    frontFace.addEventListener('animationend', done);
  }

  function next(){
    if (isMobile()){
      if (mobileIndex >= 2) return;
      const from = ASSETS[mobileIndex];
      const to = ASSETS[mobileIndex + 1];

      doFlip(from, to, ()=>{
        mobileIndex++;
        showMobile();
      });

    } else {
      if (desktopState >= 1) return;
      doFlip(ASSETS[0], ASSETS[1], ()=>{
        desktopState = 1;
        showDesktop();
      });
    }
  }

  function prev(){
    if (isMobile()){
      if (mobileIndex <= 0) return;
      const from = ASSETS[mobileIndex];
      const to = ASSETS[mobileIndex - 1];

      doFlip(from, to, ()=>{
        mobileIndex--;
        showMobile();
      });

    } else {
      if (desktopState <= 0) return;
      doFlip(ASSETS[1], ASSETS[0], ()=>{
        desktopState = 0;
        showDesktop();
      });
    }
  }

  window.addEventListener('resize', ()=>{
    if (isMobile()){
      mobileIndex = (desktopState === 0) ? 0 : 1;
    } else {
      desktopState = (mobileIndex === 0) ? 0 : 1;
    }
    layout();
  });

  layout();
</script>
</body>
</html>
