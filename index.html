<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Πρόσκληση Γάμου</title>
  <style>
    :root{
      --bg:#f6ead9;
      --ink:#4a4038;
      --gap: 14px;
      --pageAspect: 1.45;             /* height = width * aspect */
      --bookW: min(96vw, 980px);      /* desktop spread width */
    }
    *{box-sizing:border-box}
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      background: radial-gradient(900px 560px at 50% -140px, #fff 0%, var(--bg) 60%, #f2dfcb 100%);
      -webkit-tap-highlight-color: transparent;
      overflow-x:hidden;
      color: var(--ink);
    }

    .wrap{
      min-height:100svh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:12px;
      padding-left: calc(12px + env(safe-area-inset-left));
      padding-right: calc(12px + env(safe-area-inset-right));
      padding-top: calc(14px + env(safe-area-inset-top));
      padding-bottom: calc(18px + env(safe-area-inset-bottom));
      margin: 0 auto;
      max-width: 1100px;
    }

    .controls{ display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; }
    button{
      appearance:none;
      border:1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.40);
      color: var(--ink);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight:650;
      cursor:pointer;
      backdrop-filter: blur(10px);
    }
    button:active{transform: translateY(1px)}
    button:disabled{opacity:.45; cursor:not-allowed}

    /* ===== Desktop spread (unchanged) ===== */
    .desktopStage{
      width: var(--bookW);
      height: calc((var(--bookW) / 2) * var(--pageAspect));
      perspective: 2600px;
      position: relative;
    }
    .desktopBook{ position:absolute; inset:0; transform-style: preserve-3d; }

    .spread{
      position:absolute; inset:0;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
      padding: 0 6px;
      align-items:stretch;
      opacity: 0;
      transition: opacity 220ms ease;
      pointer-events:none;
      transform: translateZ(-2px);
    }
    .desktopBook.open .spread{ opacity: 1; pointer-events:auto; }

    .page{ width:100%; height:100%; background:transparent; box-shadow:none; }
    .page img{ width:100%; height:100%; display:block; object-fit:contain; background:transparent; }

    .coverWrap{
      position:absolute; top:0; bottom:0;
      left:50%;
      width: calc(var(--bookW) / 2);
      transform-style: preserve-3d;
      transform-origin: left center;
      transition: transform 980ms cubic-bezier(.16,.92,.18,1);
      z-index: 20;
    }
    .desktopBook.open .coverWrap{ transform: rotateY(-180deg); }
    .coverSide{ position:absolute; inset:0; backface-visibility:hidden; background:transparent; box-shadow:none; }
    .coverSide img{ width:100%; height:100%; display:block; object-fit:contain; background:transparent; }
    .coverBack{ transform: rotateY(180deg); }

    /* ===== Mobile single (AUTO-FIT) ===== */
    .mobileStage{
      /* fit by both width and height so it never overflows */
      width: min(92vw, calc((100svh - 190px) / var(--pageAspect)));
      max-width: 460px;

      height: calc(min(92vw, calc((100svh - 190px) / var(--pageAspect))) * var(--pageAspect));
      max-height: calc(460px * var(--pageAspect));

      perspective: 2200px;
      position: relative;
      margin: 0 auto;
      touch-action: manipulation;
    }
    .mobileBook{ position:absolute; inset:0; transform-style: preserve-3d; }

    .mobilePage{ position:absolute; inset:0; background:transparent; }
    .mobilePage img{ width:100%; height:100%; display:block; object-fit:contain; background:transparent; }

    .mCoverWrap{
      position:absolute; inset:0;
      transform-style: preserve-3d;
      transform-origin: left center;
      transition: transform 980ms cubic-bezier(.16,.92,.18,1);
      z-index: 30;
    }
    .mobileBook.openCover .mCoverWrap{ transform: rotateY(-180deg); }
    .mCoverSide{ position:absolute; inset:0; backface-visibility:hidden; }
    .mCoverBack{ transform: rotateY(180deg); }

    .turner{
      position:absolute; inset:0;
      transform-origin: left center;
      transform-style: preserve-3d;
      pointer-events:none;
      opacity:0;
      z-index: 40;
    }
    .turner img{ width:100%; height:100%; display:block; object-fit:contain; background:transparent; }
    .turner.play{
      opacity:1;
      animation: turn 520ms cubic-bezier(.2,.9,.2,1) forwards;
    }
    @keyframes turn{
      0%{ transform: rotateY(0deg); filter: brightness(1); }
      100%{ transform: rotateY(-165deg); filter: brightness(.92); }
    }

    .desktopOnly{ display:block; }
    .mobileOnly{ display:none; }

    @media (max-width: 520px){
      .wrap{
        justify-content:flex-start;
        gap:14px;
      }
      .desktopOnly{ display:none; }
      .mobileOnly{ display:block; }

      /* make sure the stage + sticky buttons fit nicely */
      .mobileStage{
        margin-top: 6px;
      }
      .controls{
        position: sticky;
        bottom: calc(10px + env(safe-area-inset-bottom));
        z-index: 60;
        padding: 10px 0 6px;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">

    <div class="desktopOnly">
      <div class="desktopStage" aria-label="Flipbook desktop">
        <div class="desktopBook" id="desktopBook">
          <div class="spread" aria-label="Διπλή σελίδα">
            <div class="page"><img src="assets/left.png" alt="Ο γάμος μας" /></div>
            <div class="page"><img src="assets/right.png" alt="Η ημέρα μας" /></div>
          </div>
          <div class="coverWrap" aria-label="Save the date">
            <div class="coverSide coverFront"><img src="assets/cover.png" alt="Save the date" /></div>
            <div class="coverSide coverBack"><img src="assets/left.png" alt="Ο γάμος μας" /></div>
          </div>
        </div>
      </div>
    </div>

    <div class="mobileOnly">
      <div class="mobileStage" aria-label="Flipbook mobile">
        <div class="mobileBook" id="mobileBook">
          <div class="mobilePage"><img id="mobileCurrent" src="assets/left.png" alt="Σελίδα" /></div>
          <div class="turner" id="turner" aria-hidden="true"><img id="turnerImg" src="assets/left.png" alt="" /></div>
          <div class="mCoverWrap" id="mCover">
            <div class="mCoverSide mCoverFront"><img src="assets/cover.png" alt="Save the date" /></div>
            <div class="mCoverSide mCoverBack"><img src="assets/left.png" alt="Ο γάμος μας" /></div>
          </div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button id="prevBtn" disabled>◀ Πίσω</button>
      <button id="nextBtn">Μπροστά ▶</button>
    </div>

    <audio id="flipSound" preload="auto">
      <source src="assets/flip.mp3" type="audio/mpeg">
      <source src="assets/flip.wav" type="audio/wav">
    </audio>
  </div>

  <script>
    (function(){
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const flipSound = document.getElementById('flipSound');

      const desktopBook = document.getElementById('desktopBook');
      const mobileBook = document.getElementById('mobileBook');
      const mobileCurrent = document.getElementById('mobileCurrent');
      const turner = document.getElementById('turner');
      const turnerImg = document.getElementById('turnerImg');

      const PAGES = ["assets/cover.png","assets/left.png","assets/right.png"];
      let audioUnlocked = false;

      function unlockAudio(){
        if(audioUnlocked) return;
        audioUnlocked = true;
        try{
          flipSound.volume = 0;
          flipSound.playbackRate = 1.45;
          const p = flipSound.play();
          if(p && p.then){
            p.then(()=>{ flipSound.pause(); flipSound.currentTime = 0; flipSound.volume = 0.28; })
             .catch(()=>{ flipSound.volume = 0.28; });
          }else{
            flipSound.pause(); flipSound.currentTime = 0; flipSound.volume = 0.28;
          }
        }catch(e){ flipSound.volume = 0.28; }
      }
      function playFlip(){
        try{
          flipSound.currentTime = 0;
          flipSound.playbackRate = 1.45;
          flipSound.volume = 0.28;
          flipSound.play();
        }catch(e){}
      }
      window.addEventListener('pointerdown', unlockAudio, { once:true });

      function isMobile(){ return window.matchMedia("(max-width: 520px)").matches; }

      let desktopOpen = false;
      let mIndex = 0; // 0 cover, 1 left, 2 right
      let busy = false;

      function setButtons(){
        if(isMobile()){
          prevBtn.disabled = (mIndex === 0);
          nextBtn.disabled = (mIndex === 2);
        }else{
          prevBtn.disabled = !desktopOpen;
          nextBtn.disabled = desktopOpen;
        }
      }

      function desktopSet(open){
        desktopOpen = open;
        desktopBook.classList.toggle("open", desktopOpen);
        setButtons();
      }

      function mobileShow(index){
        if(busy) return;
        if(index === mIndex) return;
        busy = true;

        if(mIndex === 0 && index === 1){
          playFlip();
          mobileBook.classList.add("openCover");
          setTimeout(()=>{
            mobileCurrent.src = PAGES[1];
            mIndex = 1;
            setButtons();
            busy = false;
          }, 650);
          return;
        }
        if(mIndex === 1 && index === 0){
          playFlip();
          mobileBook.classList.remove("openCover");
          setTimeout(()=>{
            mIndex = 0;
            setButtons();
            busy = false;
          }, 650);
          return;
        }

        playFlip();
        turnerImg.src = PAGES[mIndex];
        turner.classList.remove("play");
        void turner.offsetWidth;
        turner.classList.add("play");

        setTimeout(()=>{
          mobileCurrent.src = PAGES[index];
          mIndex = index;
          setButtons();
        }, 220);

        setTimeout(()=>{
          turner.classList.remove("play");
          busy = false;
        }, 560);
      }

      function goNext(){
        if(isMobile()){
          if(mIndex < 2) mobileShow(mIndex + 1);
        }else{
          desktopSet(true); playFlip();
        }
      }
      function goPrev(){
        if(isMobile()){
          if(mIndex > 0) mobileShow(mIndex - 1);
        }else{
          desktopSet(false); playFlip();
        }
      }

      nextBtn.addEventListener("click", goNext);
      prevBtn.addEventListener("click", goPrev);

      document.addEventListener("click", (e)=>{
        const stage = e.target.closest(".desktopStage, .mobileStage");
        if(!stage) return;
        const rect = stage.getBoundingClientRect();
        const x = (e.clientX || rect.left) - rect.left;
        if(x > rect.width/2) goNext(); else goPrev();
      });

      setButtons();
    })();
  </script>
</body>
</html>
