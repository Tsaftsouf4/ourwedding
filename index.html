<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Wedding Invite</title>

  <style>
    :root{
      --bg1:#f2e6d8;
      --bg2:#f6eadc;

      --shadow: 0 24px 60px rgba(0,0,0,.22);
      --radius: 22px;

      --cardW: min(1080px, 94vw);
      --cardH: min(640px, 82vh);

      --singleW: min(520px, 92vw);
      --singleH: min(760px, 84vh);

      /* πιο smooth/realistic */
      --turnDur: 1.05s;
      --ease: cubic-bezier(.16,.92,.18,1);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      min-height:100svh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px 14px;
      background: radial-gradient(1200px 700px at 50% 20%, var(--bg2), var(--bg1));
      overflow:hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    .app{
      width: 100%;
      max-width: 1200px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 14px;
    }

    .book{
      position:relative;
      width: var(--cardW);
      height: var(--cardH);
      border-radius: var(--radius);
      background: rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .stage{
      position:relative;
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
    }

    /* Desktop spread */
    .spread{
      width:100%;
      height:100%;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
      align-items:center;
      justify-items:center;
    }

    .pageImg{
      width:100%;
      height:100%;
      object-fit: contain;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.18));
      border-radius: 18px;
      transform: translateZ(0);
    }

    /* Single view (cover on desktop step0 + all mobile steps) */
    .single{
      width: var(--singleW);
      height: var(--singleH);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .single .pageImg{
      width:100%;
      height:100%;
      object-fit: contain;
    }

    .controls{
      display:flex;
      gap: 12px;
      align-items:center;
      justify-content:center;
    }
    button{
      appearance:none;
      border:0;
      background: rgba(255,255,255,.55);
      color:#2b2b2b;
      padding: 12px 18px;
      border-radius: 999px;
      font-weight: 650;
      box-shadow: 0 10px 24px rgba(0,0,0,.12);
      cursor:pointer;
      transition: transform .08s ease, opacity .15s ease;
      user-select:none;
    }
    button:active{ transform: scale(.98); }
    button:disabled{ opacity:.45; cursor:not-allowed; }

    /* ---------- FLIP LAYER ---------- */
    .flipLayer{
      pointer-events:none;
      position:absolute;
      inset:0;
      display:none;
      perspective: 1800px;
    }

    .sheet{
      position:absolute;
      inset: 18px;
      transform-style: preserve-3d;
      border-radius: var(--radius);
    }

    .paper{
      position:absolute;
      top:0; bottom:0;
      transform-style: preserve-3d;
      border-radius: 18px;
      will-change: transform;
    }

    .paperFace{
      position:absolute;
      inset:0;
      border-radius: 18px;
      backface-visibility:hidden;
      background-repeat:no-repeat;
      background-position:center;
      background-size: contain;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.18));
    }

    .paperBack{ transform: rotateY(180deg); }

    .gloss{
      position:absolute;
      inset:-2px;
      border-radius: 18px;
      background: linear-gradient(90deg,
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,.18) 35%,
        rgba(255,255,255,.10) 55%,
        rgba(255,255,255,0) 100%);
      opacity:0;
      pointer-events:none;
      mix-blend-mode: screen;
    }

    .spineShadow{
      position:absolute;
      top:0; bottom:0;
      width: 26px;
      left: calc(50% - 13px);
      background: radial-gradient(18px 90% at 100% 50%, rgba(0,0,0,.22), rgba(0,0,0,0));
      opacity:0;
    }

    /* πιο “paper” keyframes */
    @keyframes turnPage {
      0%   { transform: translateZ(0px) rotateY(0deg); }
      18%  { transform: translateZ(10px) rotateY(-22deg); }
      42%  { transform: translateZ(18px) rotateY(-88deg); }
      72%  { transform: translateZ(10px) rotateY(-150deg); }
      100% { transform: translateZ(0px) rotateY(-180deg); }
    }

    @keyframes glossMove{
      0%   { opacity:0; transform: translateX(-42%); }
      18%  { opacity:.15; }
      50%  { opacity:.35; transform: translateX(0%); }
      82%  { opacity:.18; transform: translateX(28%); }
      100% { opacity:0; transform: translateX(42%); }
    }

    .turning .paper{
      animation: turnPage var(--turnDur) var(--ease) forwards;
    }
    .turning .gloss{
      animation: glossMove var(--turnDur) var(--ease) forwards;
    }
    .turning .spineShadow{
      opacity:.55;
      transition: opacity .12s ease;
    }

    .reverse .paper{ animation-direction: reverse; }
    .reverse .gloss{ animation-direction: reverse; }

    /* ---------- Responsive ---------- */
    @media (max-width: 900px){
      .book{
        width: min(560px, 94vw);
        height: min(860px, 84vh);
      }
      .sheet{ inset:14px; }
      .stage{ padding: 14px; }

      .spread{ display:none; }
      .single{ display:flex; }

      .spineShadow{ display:none; }
      .paper{ width:100% !important; left:0 !important; transform-origin:left center !important; }
    }

    @media (min-width: 901px){
      /* desktop default: both exist, but we show/hide via JS per step */
      .single{ display:flex; }
      .spread{ display:grid; }
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="book" id="book">
      <div class="stage">
        <!-- Desktop spread -->
        <div class="spread" id="spread">
          <img id="leftImg" class="pageImg" alt="left page">
          <img id="rightImg" class="pageImg" alt="right page">
        </div>

        <!-- Single (cover on desktop step0 + mobile all steps) -->
        <div class="single" id="single">
          <img id="singleImg" class="pageImg" alt="page">
        </div>
      </div>

      <!-- flip overlay -->
      <div class="flipLayer" id="flipLayer">
        <div class="sheet" id="sheet">
          <div class="spineShadow" id="spineShadow"></div>

          <div class="paper" id="paper">
            <div class="paperFace" id="paperFront"></div>
            <div class="paperFace paperBack" id="paperBack"></div>
            <div class="gloss" id="gloss"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button id="prevBtn">◀ Πίσω</button>
      <button id="nextBtn">Μπροστά ▶</button>
    </div>

    <audio id="flipSound" src="assets/flip.mp3" preload="auto"></audio>
  </div>

  <script>
    const ASSETS = {
      cover: "assets/cover.png",
      left:  "assets/left.png",
      right: "assets/right.png"
    };

    const mqMobile = window.matchMedia("(max-width: 900px)");

    const spread = document.getElementById("spread");
    const single = document.getElementById("single");

    const leftImg = document.getElementById("leftImg");
    const rightImg = document.getElementById("rightImg");
    const singleImg = document.getElementById("singleImg");

    const flipLayer = document.getElementById("flipLayer");
    const sheet = document.getElementById("sheet");
    const paper = document.getElementById("paper");
    const paperFront = document.getElementById("paperFront");
    const paperBack  = document.getElementById("paperBack");
    const spineShadow = document.getElementById("spineShadow");

    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const sound = document.getElementById("flipSound");

    let isMobile = mqMobile.matches;
    let isAnimating = false;

    // Desktop steps: 0 cover, 1 spread(left+right)
    // Mobile  steps: 0 cover, 1 left, 2 right
    let step = 0;

    function stepsCount(){ return isMobile ? 3 : 2; }

    function updateButtons(){
      prevBtn.disabled = (step === 0 || isAnimating);
      nextBtn.disabled = (step === stepsCount()-1 || isAnimating);
    }

    function safePlay(){
      try{
        sound.currentTime = 0;
        sound.playbackRate = 1.2; // λίγο πιο “γρήγορο/σφιχτό”
        sound.play().catch(()=>{});
      }catch(e){}
    }

    function setupFlipGeometry(){
      flipLayer.style.display = "none";
      sheet.classList.remove("turning","reverse");

      if(isMobile){
        paper.style.left = "0";
        paper.style.width = "100%";
        paper.style.transformOrigin = "left center";
        spineShadow.style.opacity = "0";
      }else{
        // στο desktop γυρνάει η δεξιά “μισή” σελίδα όταν πάμε στο spread
        paper.style.left = "50%";
        paper.style.width = "50%";
        paper.style.transformOrigin = "left center";
      }
    }

    function setViewInstant(){
      if(isMobile){
        // mobile: single only
        spread.style.display = "none";
        single.style.display = "flex";

        if(step === 0) singleImg.src = ASSETS.cover;
        if(step === 1) singleImg.src = ASSETS.left;
        if(step === 2) singleImg.src = ASSETS.right;

      } else {
        // desktop:
        if(step === 0){
          // cover only (single centered)
          spread.style.display = "none";
          single.style.display = "flex";
          singleImg.src = ASSETS.cover;
        } else {
          // spread
          single.style.display = "none";
          spread.style.display = "grid";
          leftImg.src = ASSETS.left;
          rightImg.src = ASSETS.right;
        }
      }
      updateButtons();
    }

    function showFlip(frontImg, backImg, direction){
      paperFront.style.backgroundImage = `url("${frontImg}")`;
      paperBack.style.backgroundImage  = `url("${backImg}")`;

      sheet.classList.remove("turning","reverse");
      void sheet.offsetWidth;

      flipLayer.style.display = "block";
      sheet.classList.add("turning");
      if(direction === "prev") sheet.classList.add("reverse");

      safePlay();
    }

    function hideFlip(){
      flipLayer.style.display = "none";
      sheet.classList.remove("turning","reverse");
    }

    function animateTo(newStep){
      if(isAnimating) return;
      if(newStep === step) return;
      if(newStep < 0 || newStep > stepsCount()-1) return;

      const oldStep = step;
      const dir = newStep > oldStep ? "next" : "prev";

      isAnimating = true;
      updateButtons();

      let frontImg, backImg;

      if(isMobile){
        // flip whole page: old -> new
        const getImg = (s)=> s===0?ASSETS.cover : s===1?ASSETS.left : ASSETS.right;
        frontImg = getImg(oldStep);
        backImg  = getImg(newStep);
      } else {
        // desktop: cover <-> spread
        if(oldStep === 0 && newStep === 1){
          frontImg = ASSETS.cover;
          backImg  = ASSETS.right; // φαίνεται ωραίο όταν “ανοίγει”
        } else if(oldStep === 1 && newStep === 0){
          frontImg = ASSETS.right;
          backImg  = ASSETS.cover;
        } else {
          frontImg = ASSETS.right;
          backImg  = ASSETS.right;
        }
      }

      showFlip(frontImg, backImg, dir);

      // swap view περίπου στη μέση για “paper” αίσθηση
      const swapAt = Math.round(1050 * 0.55);
      setTimeout(()=>{
        step = newStep;
        setViewInstant();
      }, swapAt);

      const endAt = 1050 + 60;
      setTimeout(()=>{
        hideFlip();
        isAnimating = false;
        updateButtons();
      }, endAt);
    }

    prevBtn.addEventListener("click", ()=> animateTo(step-1));
    nextBtn.addEventListener("click", ()=> animateTo(step+1));

    // swipe
    let startX = null;
    document.getElementById("book").addEventListener("touchstart", (e)=>{
      if(e.touches && e.touches.length===1) startX = e.touches[0].clientX;
    }, {passive:true});

    document.getElementById("book").addEventListener("touchend", (e)=>{
      if(startX === null) return;
      const endX = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0].clientX : startX;
      const dx = endX - startX;
      startX = null;
      if(Math.abs(dx) < 45) return;
      if(dx < 0) animateTo(step+1);
      else animateTo(step-1);
    }, {passive:true});

    // resize mode switch
    function handleResize(){
      const nowMobile = mqMobile.matches;
      if(nowMobile !== isMobile){
        // map step
        if(nowMobile){
          // desktop->mobile: αν ήσουν στο spread πήγαινε στο left
          step = (step===1) ? 1 : 0;
        } else {
          // mobile->desktop: αν ήσουν σε left/right πήγαινε στο spread
          step = (step>=1) ? 1 : 0;
        }
        isMobile = nowMobile;
        setupFlipGeometry();
        setViewInstant();
      }
    }

    window.addEventListener("resize", handleResize);

    // init
    setupFlipGeometry();
    setViewInstant();
  </script>
</body>
</html>
