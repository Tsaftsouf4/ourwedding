<!doctype html>
<html lang="el">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Πρόσκληση Γάμου</title>

<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{width:100%;height:100%;overflow:hidden;background:#f6ead8}

  :root{
    --pageAspect: 1.45;
    --shadow: 0 18px 40px rgba(0,0,0,.22);
    --radius: 22px;
    --bg: #f6ead8;

    /* smoother + more “magazine” */
    --turnDur: .92s;
    --turnEase: cubic-bezier(.12,.92,.12,1);
  }

  .wrap{
    width:100vw;height:100svh;
    display:flex;align-items:center;justify-content:center;
    position:relative;
    background:var(--bg);
  }

  .stage{
    position:relative;
    perspective: 1400px;
    perspective-origin: 50% 50%;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .spread{
    display:flex;
    gap:28px;
    align-items:center;
    justify-content:center;
  }

  .page{
    border-radius: var(--radius);
    overflow:hidden;
    box-shadow: var(--shadow);
    background:transparent;
  }
  .page img{
    width:100%;height:100%;
    object-fit:contain;
    display:block;
  }

  .nav{
    position:absolute;
    bottom:26px;
    display:flex;
    gap:14px;
    z-index:50;
  }
  button{
    background: rgba(255,255,255,.65);
    border:none;
    padding:10px 18px;
    border-radius:999px;
    font-size:14px;
    cursor:pointer;
    backdrop-filter: blur(6px);
  }
  button:disabled{ opacity:.45; cursor:not-allowed; }

  /* ===== UNDER PAGE (next page visible behind turn) ===== */
  .underPage{
    position:absolute;
    top:0;left:0;
    width:100%;height:100%;
    border-radius: var(--radius);
    overflow:hidden;
    box-shadow: var(--shadow);
    display:none;
    z-index:10;
    pointer-events:none;
    background:transparent;

    /* nicer reveal */
    opacity:0;
    transform-origin:center;
  }
  .underPage.show{
    display:block;
    animation: underIn var(--turnDur) var(--turnEase) forwards;
  }
  .underPage img{
    width:100%;height:100%;
    object-fit:contain;
    display:block;
  }

  @keyframes underIn{
    0%   { opacity:0; transform: translateZ(0) scale(.996); }
    35%  { opacity:.35; }
    100% { opacity:1; transform: translateZ(0) scale(1); }
  }

  /* ===== FLIP LAYER (MAGAZINE CURL) ===== */
  .flipLayer{
    position:absolute;
    top:0;left:0;
    transform-style: preserve-3d;
    z-index:40;
    pointer-events:none;
    display:none;
  }
  .flipLayer.show{ display:block; }

  .sheet{
    position:absolute;
    top:0;left:0;
    width:100%;height:100%;
    transform-style: preserve-3d;
    transform-origin: left center;
    will-change: transform, filter, clip-path;
  }

  .face{
    position:absolute;
    top:0;left:0;
    width:100%;height:100%;
    backface-visibility:hidden;
    border-radius: var(--radius);
    overflow:hidden;
    box-shadow: var(--shadow);
    background:transparent;
  }
  .face img{
    width:100%;height:100%;
    object-fit:contain;
    display:block;
  }

  /* We animate only the current page (front) */
  .back{ display:none; }

  .specular{
    position:absolute; inset:-2px;
    border-radius: var(--radius);
    pointer-events:none;
    opacity:0;
    background: linear-gradient(90deg,
      rgba(255,255,255,0) 0%,
      rgba(255,255,255,.06) 30%,
      rgba(255,255,255,.22) 48%,
      rgba(255,255,255,.06) 63%,
      rgba(255,255,255,0) 100%
    );
    mix-blend-mode: screen;
  }

  .curlShadow{
    position:absolute; inset:0;
    border-radius: var(--radius);
    pointer-events:none;
    opacity:0;
    background: radial-gradient(120% 90% at 18% 50%,
      rgba(0,0,0,.22) 0%,
      rgba(0,0,0,.10) 30%,
      rgba(0,0,0,0) 62%
    );
    filter: blur(1.2px);
    mix-blend-mode: multiply;
  }

  .bendShade{
    position:absolute; inset:0;
    border-radius: var(--radius);
    pointer-events:none;
    opacity:0;
    background: linear-gradient(90deg,
      rgba(0,0,0,.00) 0%,
      rgba(0,0,0,.10) 18%,
      rgba(0,0,0,.18) 38%,
      rgba(0,0,0,.10) 58%,
      rgba(0,0,0,.00) 78%
    );
    mix-blend-mode: multiply;
    filter: blur(1.2px);
  }

  .bendRim{
    position:absolute; inset:0;
    border-radius: var(--radius);
    pointer-events:none;
    opacity:0;
    background: linear-gradient(90deg,
      rgba(255,255,255,0) 0%,
      rgba(255,255,255,.10) 55%,
      rgba(255,255,255,.30) 72%,
      rgba(255,255,255,.08) 86%,
      rgba(255,255,255,0) 100%
    );
    mix-blend-mode: screen;
    filter: blur(.6px);
  }

  .edge{
    position:absolute;
    top:0; bottom:0; left:0;
    width:10px;
    opacity:0;
    background: linear-gradient(90deg,
      rgba(255,255,255,.35),
      rgba(255,255,255,.08),
      rgba(255,255,255,0)
    );
    pointer-events:none;
  }

  /* ===== KEYFRAMES: softer “magazine” turn (less door / cardboard) ===== */
  @keyframes magazineTurn {
    0%{
      transform: rotateY(0deg) translateX(0) skewY(0deg) rotateZ(0deg) scaleX(1) scaleY(1);
      clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
      filter: brightness(1) saturate(1);
    }

    18%{
      transform: rotateY(-18deg) translateX(4px) skewY(-1.2deg) rotateZ(-.35deg) scaleX(.995) scaleY(.998);
      clip-path: polygon(0 0, 95% 0, 100% 16%, 100% 84%, 95% 100%, 0 100%);
      filter: brightness(.997) saturate(1);
    }

    42%{
      transform: rotateY(-42deg) translateX(14px) skewY(-3.0deg) rotateZ(-.85deg) scaleX(.972) scaleY(.995);
      clip-path: polygon(0 0, 80% 0, 100% 26%, 100% 74%, 80% 100%, 0 100%);
      filter: brightness(.992) saturate(.995);
    }

    /* small “floppy wave” */
    62%{
      transform: rotateY(-58deg) translateX(22px) skewY(-4.2deg) rotateZ(-1.05deg) scaleX(.952) scaleY(.992);
      clip-path: polygon(0 0, 72% 0, 100% 34%, 100% 66%, 72% 100%, 0 100%);
      filter: brightness(.989) saturate(.992);
    }

    78%{
      transform: rotateY(-64deg) translateX(26px) skewY(-3.6deg) rotateZ(-.95deg) scaleX(.945) scaleY(.99);
      clip-path: polygon(0 0, 70% 0, 100% 36%, 100% 64%, 70% 100%, 0 100%);
      filter: brightness(.988) saturate(.99);
    }

    100%{
      transform: rotateY(-72deg) translateX(30px) skewY(-3.2deg) rotateZ(-.85deg) scaleX(.94) scaleY(.99);
      clip-path: polygon(0 0, 66% 0, 100% 40%, 100% 60%, 66% 100%, 0 100%);
      filter: brightness(.987) saturate(.99);
    }
  }

  /* richer moving gloss */
  @keyframes specularMove{
    0%   { opacity:0; transform: translateX(-40%) skewX(-12deg); }
    22%  { opacity:.12; }
    52%  { opacity:.34; transform: translateX(6%) skewX(-10deg); }
    78%  { opacity:.20; transform: translateX(28%) skewX(-8deg); }
    100% { opacity:0; transform: translateX(44%) skewX(-6deg); }
  }

  @keyframes curlShadowMove{
    0%   { opacity:0; transform: translateX(-6px); }
    30%  { opacity:.10; }
    55%  { opacity:.24; transform: translateX(8px); }
    100% { opacity:0; transform: translateX(18px); }
  }

  @keyframes bendShadeMove{
    0%   { opacity:0; transform: translateX(-10px); }
    25%  { opacity:.10; }
    55%  { opacity:.22; transform: translateX(10px); }
    100% { opacity:0; transform: translateX(22px); }
  }

  @keyframes bendRimMove{
    0%   { opacity:0; transform: translateX(-18%); }
    35%  { opacity:.16; }
    65%  { opacity:.30; transform: translateX(18%); }
    100% { opacity:0; transform: translateX(34%); }
  }

  @keyframes edgeOn{
    0%{opacity:0}
    35%{opacity:.10}
    60%{opacity:.16}
    100%{opacity:0}
  }

  .turning{
    animation: magazineTurn var(--turnDur) var(--turnEase) forwards;
    /* tiny motion blur feel */
    filter: blur(.25px);
  }
  .turning .specular{ animation: specularMove var(--turnDur) var(--turnEase) forwards; }
  .turning .curlShadow{ animation: curlShadowMove var(--turnDur) var(--turnEase) forwards; }
  .turning .bendShade{ animation: bendShadeMove var(--turnDur) var(--turnEase) forwards; }
  .turning .bendRim{ animation: bendRimMove var(--turnDur) var(--turnEase) forwards; }
  .turning .edge{ animation: edgeOn var(--turnDur) var(--turnEase) forwards; }

  /* ===== SIZES ===== */
  @media (min-width: 901px){
    .page{
      width: min(38vw, 420px);
      height: calc(min(38vw, 420px) * var(--pageAspect));
    }
    .stage{
      width: calc((min(38vw, 420px) * 2) + 28px);
      height: calc(min(38vw, 420px) * var(--pageAspect));
    }
  }

  /* mobile sizing (stable) */
  @media (max-width: 900px){
    .stage{
      width: min(92vw, calc(92svh / var(--pageAspect)));
      height: calc(min(92vw, calc(92svh / var(--pageAspect))) * var(--pageAspect));
    }
    .page{ width:100%; height:100%; }
  }

  .hidden{ display:none !important; }
</style>
</head>

<body>
<div class="wrap">
  <div class="stage" id="stage">

    <!-- Desktop container -->
    <div class="spread" id="spreadDesktop">
      <div class="page" id="desktopLeft"><img src="assets/left.png" alt="Ο γάμος μας"></div>
      <div class="page" id="desktopRight"><img src="assets/right.png" alt="Η ημέρα μας"></div>
    </div>

    <!-- Cover -->
    <div class="page" id="coverSingle"><img src="assets/cover.png" alt="Cover"></div>

    <!-- Under page (next page visible immediately) -->
    <div class="underPage" id="underPage"><img id="underImg" src="" alt=""></div>

    <!-- Flip layer (only current page turning away) -->
    <div class="flipLayer" id="flipLayer">
      <div class="sheet" id="sheet">
        <div class="face front">
          <img id="frontImg" src="" alt="">
          <div class="specular"></div>
          <div class="curlShadow"></div>
          <div class="bendShade"></div>
          <div class="bendRim"></div>
          <div class="edge"></div>
        </div>
        <div class="face back"></div>
      </div>
    </div>

    <!-- Mobile single -->
    <div class="page hidden" id="mobileSingle"><img id="mobileImg" src="" alt=""></div>

  </div>

  <div class="nav">
    <button id="prevBtn" onclick="prev()">◀ Πίσω</button>
    <button id="nextBtn" onclick="next()">Μπροστά ▶</button>
  </div>
</div>

<audio id="flipSound" src="assets/flip.mp3" preload="auto"></audio>

<script>
  const sound = document.getElementById('flipSound');

  const stage = document.getElementById('stage');
  const spreadDesktop = document.getElementById('spreadDesktop');
  const coverSingle = document.getElementById('coverSingle');

  const mobileSingle = document.getElementById('mobileSingle');
  const mobileImg = document.getElementById('mobileImg');

  const underPage = document.getElementById('underPage');
  const underImg  = document.getElementById('underImg');

  const flipLayer = document.getElementById('flipLayer');
  const sheet = document.getElementById('sheet');
  const frontImg = document.getElementById('frontImg');

  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  const ASSETS = ["assets/cover.png","assets/left.png","assets/right.png"];

  // treat landscape phones as mobile too
  function isMobile(){
    return window.matchMedia("(max-width: 900px)").matches || Math.min(window.innerWidth, window.innerHeight) <= 900;
  }

  let desktopState = 0;   // 0 cover, 1 spread
  let mobileIndex = 0;    // 0 cover, 1 left, 2 right
  let busy = false;

  function playFlip(){
    sound.currentTime = 0;
    sound.playbackRate = 1.18;
    sound.play().catch(()=>{});
  }

  function updateButtons(){
    if (isMobile()){
      prevBtn.disabled = busy || (mobileIndex <= 0);
      nextBtn.disabled = busy || (mobileIndex >= 2);
    } else {
      prevBtn.disabled = busy || (desktopState <= 0);
      nextBtn.disabled = busy || (desktopState >= 1);
    }
  }

  function showDesktop(){
    mobileSingle.classList.add('hidden');
    spreadDesktop.classList.toggle('hidden', desktopState === 0);
    coverSingle.classList.toggle('hidden', desktopState !== 0);
    updateButtons();
  }

  function showMobile(){
    spreadDesktop.classList.add('hidden');
    coverSingle.classList.add('hidden');
    mobileSingle.classList.remove('hidden');
    mobileImg.src = ASSETS[mobileIndex];
    updateButtons();
  }

  function layout(){
    if (isMobile()) showMobile();
    else showDesktop();
  }

  function placeOverStage(el, w, h, left, top){
    el.style.width = w + "px";
    el.style.height = h + "px";
    el.style.transform = `translate(${left}px, ${top}px)`;
  }

  // show NEXT under, animate CURRENT on top
  function doFlip(currentSrc, nextSrc, onDone){
    if (busy) return;
    busy = true;
    updateButtons();

    const rect = stage.getBoundingClientRect();
    let w, h, left, top;

    if (isMobile()){
      w = rect.width; h = rect.height; left = 0; top = 0;
    } else {
      const c = coverSingle.getBoundingClientRect();
      w = c.width; h = c.height;
      left = (rect.width - w) / 2;
      top  = (rect.height - h) / 2;
    }

    underImg.src = nextSrc;
    placeOverStage(underPage, w, h, left, top);
    underPage.classList.add('show');

    frontImg.src = currentSrc;
    placeOverStage(flipLayer, w, h, left, top);
    flipLayer.classList.add('show');

    sheet.classList.remove('turning');
    void sheet.offsetWidth;

    playFlip();
    sheet.classList.add('turning');

    const done = () => {
      sheet.removeEventListener('animationend', done);
      sheet.classList.remove('turning');
      flipLayer.classList.remove('show');
      underPage.classList.remove('show');
      busy = false;
      updateButtons();
      if (onDone) onDone();
    };

    sheet.addEventListener('animationend', done);
  }

  function next(){
    if (isMobile()){
      if (mobileIndex >= 2 || busy) return;
      doFlip(ASSETS[mobileIndex], ASSETS[mobileIndex + 1], ()=>{
        mobileIndex++;
        showMobile();
      });
    } else {
      if (desktopState >= 1 || busy) return;
      doFlip(ASSETS[0], ASSETS[1], ()=>{
        desktopState = 1;
        showDesktop();
      });
    }
  }

  function prev(){
    if (isMobile()){
      if (mobileIndex <= 0 || busy) return;
      doFlip(ASSETS[mobileIndex], ASSETS[mobileIndex - 1], ()=>{
        mobileIndex--;
        showMobile();
      });
    } else {
      if (desktopState <= 0 || busy) return;
      doFlip(ASSETS[1], ASSETS[0], ()=>{
        desktopState = 0;
        showDesktop();
      });
    }
  }

  window.addEventListener('resize', ()=>{
    if (isMobile()){
      mobileIndex = (desktopState === 0) ? 0 : 1;
    } else {
      desktopState = (mobileIndex === 0) ? 0 : 1;
    }
    layout();
  });

  layout();
</script>
</body>
</html>
